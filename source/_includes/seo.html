<!--
  Centralized SEO Include
  ======================
  This include handles all SEO meta tags, structured data, and social media optimization
  for the Early Days of Ethereum site. It provides smart defaults and content-specific
  optimizations while maintaining fine-grained control.
-->

{% comment %}
  =========================
  SEO Variables Setup
  =========================
{% endcomment %}

{% assign seo_title = page.title | default: page.name | default: site.title %}
{% if page.title or page.name %}
  {% assign seo_title = seo_title | append: " - " | append: site.title %}
{% endif %}

{% assign seo_description = page.description | default: page.excerpt | strip_html | truncate: 160 | default: site.description %}

{% assign seo_author = page.author | default: site.author %}

{% assign seo_url = page.url | absolute_url %}

{% comment %} Smart image selection {% endcomment %}
{% assign seo_image = page.image | default: page.photo %}
{% unless seo_image %}
  {% if page.collection == 'people' %}
    {% assign seo_image = "/images/archive.org/ethdev.com/20151210143340/ethdev-team_1200x630.png" %}
  {% else %}
    {% assign seo_image = "/images/archive.org/ethereum.org/20140428062102/internetarchive_ethereum.org_20140428062102.png" %}
  {% endif %}
{% endunless %}

{% comment %} Skip social metadata for hidden profiles to prevent privacy leaks {% endcomment %}
{% assign skip_social_meta = false %}
{% if page.collection == 'people' and (page.hidden == true or page.hidden == 'true') %}
  {% assign skip_social_meta = true %}
{% endif %}

{% unless skip_social_meta %}
  {% assign seo_image = seo_image | absolute_url %}
{% endunless %}

{% comment %} Content type detection {% endcomment %}
{% assign seo_type = "website" %}
{% if page.collection == 'people' %}
  {% assign seo_type = "profile" %}
{% elsif page.collection == 'articles' %}
  {% assign seo_type = "article" %}
{% elsif page.collection == 'videos' %}
  {% assign seo_type = "video.other" %}
{% endif %}

{% comment %}
  =========================
  Basic SEO Meta Tags
  =========================
{% endcomment %}

<title>{{ seo_title }}</title>
<meta name="description" content="{{ seo_description }}">
{% if site.keywords %}<meta name="keywords" content="{{ site.keywords }}">{% endif %}
<meta name="author" content="{{ seo_author }}">
<link rel="canonical" href="{{ seo_url }}">

{% comment %} Robots meta tag {% endcomment %}
{% if page.noindex %}
<meta name="robots" content="noindex, nofollow">
{% else %}
<meta name="robots" content="index, follow">
{% endif %}

{% comment %} Language and locale {% endcomment %}
<meta name="language" content="{{ site.lang | default: 'en' }}">

{% unless skip_social_meta %}
<meta property="og:locale" content="{{ site.lang | default: 'en_US' }}">
{% comment %}
  =========================
  Open Graph Meta Tags
  =========================
{% endcomment %}

<meta property="og:type" content="{{ seo_type }}">
<meta property="og:site_name" content="{{ site.title }}">
<meta property="og:title" content="{{ seo_title }}">
<meta property="og:description" content="{{ seo_description }}">
<meta property="og:url" content="{{ seo_url }}">
<meta property="og:image" content="{{ seo_image }}">
<meta property="og:image:alt" content="{% if page.collection == 'people' %}{{ page.name | default: page.title }} - Early Days of Ethereum{% else %}{{ seo_title }}{% endif %}">

{% comment %} Content-specific Open Graph tags {% endcomment %}
{% if page.collection == 'people' %}
<meta property="profile:first_name" content="{{ page.name | split: ' ' | first }}">
<meta property="profile:last_name" content="{{ page.name | split: ' ' | last }}">
{% endif %}

{% if page.collection == 'articles' %}
<meta property="article:author" content="{{ seo_author }}">
{% if page.date %}<meta property="article:published_time" content="{{ page.date | date_to_xmlschema }}">{% endif %}
{% if page.modified_date %}<meta property="article:modified_time" content="{{ page.modified_date | date_to_xmlschema }}">{% endif %}
{% if page.tags %}
  {% for tag in page.tags %}
<meta property="article:tag" content="{{ tag }}">
  {% endfor %}
{% endif %}
{% endif %}

{% comment %}
  =========================
  Twitter Card Meta Tags
  =========================
{% endcomment %}

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@{{ site.twitter.username | default: 'bobsummerwill' }}">
<meta name="twitter:creator" content="@{{ page.twitter_creator | default: site.twitter.username | default: 'bobsummerwill' }}">
<meta name="twitter:title" content="{{ seo_title }}">
<meta name="twitter:description" content="{{ seo_description }}">
<meta name="twitter:image" content="{{ seo_image }}">
<meta name="twitter:image:alt" content="{% if page.collection == 'people' %}{{ page.name | default: page.title }} - Early Days of Ethereum{% else %}{{ seo_title }}{% endif %}">

{% comment %}
  =========================
  LinkedIn-specific tags
  =========================
{% endcomment %}

<meta property="linkedin:owner" content="{{ site.social.linkedin | default: 'bobsummerwill' }}">
{% endunless %}

{% comment %}
  =========================
  JSON-LD Structured Data
  =========================
{% endcomment %}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      "@id": "{{ site.url }}/#website",
      "url": "{{ site.url }}",
      "name": "{{ site.title }}",
      "description": "{{ site.description }}",
      "publisher": {
        "@id": "{{ site.url }}/#organization"
      },
      "potentialAction": [
        {
          "@type": "SearchAction",
          "target": {
            "@type": "EntryPoint",
            "urlTemplate": "{{ site.url }}/search?q={search_term_string}"
          },
          "query-input": "required name=search_term_string"
        }
      ]
    },
    {
      "@type": "Organization",
      "@id": "{{ site.url }}/#organization",
      "name": "{{ site.title }}",
      "url": "{{ site.url }}",
      "description": "{{ site.description }}",
      "logo": {
        "@type": "ImageObject",
        "url": "{{ '/images/archive.org/ethereum.org/20140428062102/internetarchive_ethereum.org_20140428062102.png' | absolute_url }}"
      },
      "sameAs": [
        {% if site.social.links %}
          {% for link in site.social.links %}
        "{{ link }}"{% unless forloop.last %},{% endunless %}
          {% endfor %}
        {% endif %}
      ]
    }
    {% if page.collection == 'people' and skip_social_meta != true %},
    {
      "@type": "Person",
      "@id": "{{ seo_url }}/#person",
      "name": "{{ page.name }}",
      {% if page.nickname %}"alternateName": "{{ page.nickname }}",{% endif %}
      "url": "{{ seo_url }}",
      "description": "{{ seo_description }}",
      {% if page.photo %}"image": "{{ page.photo | absolute_url }}",{% endif %}
      {% if page.social %}
      "sameAs": [
        {% assign social_links = "" %}
        {% if page.social.website %}{% assign social_links = social_links | append: '"' | append: page.social.website | append: '",' %}{% endif %}
        {% if page.social.github %}{% assign social_links = social_links | append: '"' | append: page.social.github | append: '",' %}{% endif %}
        {% if page.social.twitter %}{% assign social_links = social_links | append: '"' | append: page.social.twitter | append: '",' %}{% endif %}
        {% if page.social.linkedin %}{% assign social_links = social_links | append: '"' | append: page.social.linkedin | append: '",' %}{% endif %}
        {% if page.social.wikipedia %}{% assign social_links = social_links | append: '"' | append: page.social.wikipedia | append: '",' %}{% endif %}
        {{ social_links | remove_last: ',' }}
      ],
      {% endif %}
      "worksFor": {
        "@type": "Organization",
        "name": "Ethereum",
        "description": "Decentralized blockchain platform"
      }
    }
    {% elsif page.collection == 'articles' %},
    {
      "@type": "Article",
      "@id": "{{ seo_url }}/#article",
      "headline": "{{ page.title }}",
      "description": "{{ seo_description }}",
      "url": "{{ seo_url }}",
      {% if page.date %}"datePublished": "{{ page.date | date_to_xmlschema }}",{% endif %}
      {% if page.modified_date %}"dateModified": "{{ page.modified_date | date_to_xmlschema }}",{% endif %}
      "author": {
        "@type": "Person",
        "name": "{{ seo_author }}"
      },
      "publisher": {
        "@id": "{{ site.url }}/#organization"
      },
      {% if seo_image %}"image": "{{ seo_image }}",{% endif %}
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "{{ seo_url }}"
      }
    }
    {% elsif page.collection == 'videos' %},
    {
      "@type": "VideoObject",
      "@id": "{{ seo_url }}/#video",
      "name": "{{ page.title }}",
      "description": "{{ seo_description }}",
      "url": "{{ seo_url }}",
      {% if page.date %}"uploadDate": "{{ page.date | date_to_xmlschema }}",{% endif %}
      {% if page.duration %}"duration": "{{ page.duration }}",{% endif %}
      {% if seo_image %}"thumbnailUrl": "{{ seo_image }}",{% endif %}
      "publisher": {
        "@id": "{{ site.url }}/#organization"
      }
    }
    {% else %},
    {
      "@type": "WebPage",
      "@id": "{{ seo_url }}/#webpage",
      "url": "{{ seo_url }}",
      "name": "{{ seo_title }}",
      "description": "{{ seo_description }}",
      "isPartOf": {
        "@id": "{{ site.url }}/#website"
      },
      "about": {
        "@id": "{{ site.url }}/#organization"
      }
    }
    {% endif %}
  ]
}
</script>

{% comment %}
  =========================
  Additional SEO Elements
  =========================
{% endcomment %}

{% comment %} Preload critical resources {% endcomment %}
<link rel="preload" href="{{ '/assets/css/common.css' | relative_url }}" as="style">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://www.google-analytics.com">

{% comment %} Favicon and app icons {% endcomment %}
<link rel="icon" type="image/x-icon" href="{{ '/favicon.ico' | relative_url }}">

{% comment %} Site verification {% endcomment %}
{% if site.google_site_verification %}
<meta name="google-site-verification" content="{{ site.google_site_verification }}">
{% endif %}
{% if site.bing_site_verification %}
<meta name="msvalidate.01" content="{{ site.bing_site_verification }}">
{% endif %}

{% comment %} Reading time for articles {% endcomment %}
{% if page.collection == 'articles' %}
  {% assign words = content | strip_html | number_of_words %}
  {% assign reading_time = words | divided_by: 200 | plus: 1 %}
<meta name="twitter:label1" content="Reading time">
<meta name="twitter:data1" content="{{ reading_time }} min read">
{% endif %}
